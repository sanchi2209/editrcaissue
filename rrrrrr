///model

const mongoose=require('mongoose')
const Schema=mongoose.Schema

const RcaData=new mongoose.Schema({
    RCA:{type:String,required:true} 
    // createdAt:{type:Date,default:Date.now}
})

const RCA=mongoose.model("RCA",RcaData);
module.exports=RCA;


//crud backend

const express=require('express')
const bodyParser=require("body-parser")
const mongoose = require("mongoose");
const router = express.Router();

const RcaSchema=require('../Models/rcaticket');

router.use(bodyParser.urlencoded({ extended: false }))
router.use(bodyParser.json())

router.use(express.json());

router.post('/rcapost',async(req,res)=>{
   try {
    const{RCA}=req.body;
    const RcaPostData=new RcaSchema({RCA});
    console.log(RcaPostData);
    const savedData=await RcaPostData.save();
    res.status(200).json(savedData);
   } catch (error) {
    res.status(404).json({message:error.message});
    console.log("no rca data is found")
   }
})



router.put('/rcapost/:id',async(req,res)=>{
    try {
        const {id}=req.params.id;
      const   RcaUpdatedData=await RcaSchema.findByIdAndUpdate(id,req.body,{new:true});
      console.log( RcaUpdatedData);
      res.status(200).json( RcaUpdatedData)
    } catch (error) {
        res.status(500).send("editing is not updating");
    }
})
// getting the data 
router.get('/',(req,res)=>{
    res.status(200).send("router is working")
})
router.get('/rcagetdata',async(req,res)=>{
    try{
        const RcagetData=await  RcaSchema.find();
        // const executives=await  ExecutiveSummary.find().sort({createdAt:-1}).limit(10);
        res.status(200).json(RcagetData);
    }catch(error){
        res.status(500).send("not getting commands")
    }
})
router.get("/rcagetdata/:id",async(req,res)=>{
    try {
        const {id}=req.params;
        console.log(id)
        const RcagetData=await RcaSchema.findById(id);
        
        res.status(200).json(RcagetData);
        console.log('getting rca data correctly from the backend',RcagetData)
    } catch (error) {
        res.status(500).send("unable to get rca data ")
    }
})

module.exports=router;




/////////////////////////////////////////////////////frontend////////////////////////////////////////////
     <div style="display: table-row; margin-bottom: 10px;">
                        <div style="display: table-cell; white-space: nowrap; padding-right: 20px; padding-bottom:10px;"><strong>RCA</strong></div>
                        <div style="display: table-cell; text-align: center; width: 10px; padding: 0 10px;">:</div>
                        <form name="rcaform"  id="rcaform" onsubmit="submitrcasummaryform(event)" method="POST">
                          <input type="hidden" id="ticketId" value="" /> <!-- Hidden input field for ticket ID -->
                          <p style="margin-bottom:0px;display: flex;flex-direction: row;align-items: center;height:100%;width:100%;">
                           
                            <input type="text" id="rcatext"  name="rca"  placeholder="Enter rca" style="width:100%;height:100%;border:1px solid black" disabled="disabled"/>
                           
                          </p>
                          <p style="width: 100%;display: flex; flex-direction: row; justify-content: flex-end; align-items: center;">
                            <span id="editrcasummary" onclick="EditRcaSummaryForm()"><i class='icon icon-edit' id="rcaeditbtn" style="font-size: 20px;"  ></i></span>
                          <span  id="submitrcasummary" onclick="submitrcasummaryform(event)"><i class='bi bi-check' id="rcasubmitbtn" style="font-size: 30px;;"  ></i></span>
                         </p>
                          </form>
                        </div> 



///////js
 async function EditRcaSummaryForm(){
      debugger
      const rcaText=document.getElementById("rcatext");
      rcaText.disabled=false;
 const id=localStorage.getItem("rcasummaryid");
      // const rcaval='EEPS-1234'
      // console.log("getting rcaval",rcaval);
      // const response=await fetch(`http://localhost:3000/rca/rcagetdata/${rcaval}`)
      //   const Data=await response.json();
       const Data=JSON.parse(localStorage.getItem("rcainfo"));
      
    //  if(response.ok){
    //    const Data=await response.json();
    //    console.log("rca value in the frontend",Data);
       
      console.log('datareusing',Data);    //getting editable data here 

      // if(Data){
      //   const response=await fetch(`http://localhost:3000/rca/rcagetdata/${id}`)
      //    const Data=await response.json();
      document.getElementById("rcatext").value=Data.RCA;
      // }
    }
  
  
    async function submitrcasummaryform(event){
       const  rcasummary=document.getElementById("rcatext").value;
       console.log(rcasummary);
      debugger
      try {
        const response=await fetch('http://localhost:3000/rca/rcapost',
       {
        method:'POST',
        headers:{
          'Content-Type':'application/json'
        },
        body:JSON.stringify({RCA:rcasummary})
    
      });
      if(response.ok){
        const Data=await response.json();
        console.log("rca value in the frontend",Data);
        
        const id=Data._id;   //666666/........
        console.log(id);
     localStorage.setItem("rcasummaryid",id)  //contains existing data id
    //  window.rcaid=Data._id
localStorage.setItem('rcainformation',JSON.stringify(Data));   //contain data
         
        // document.getElementById("rcatext").textContent=Data.RCA;
        document.getElementById("rcatext").value=Data.RCA;
        console.log("only rca value",Data.RCA)
       
          //EEPS-1541
        document.getElementById("rcatext").disabled=true;
        RcaGetData()
      }else{
        console.error('Error submitting summary');
        const errorData=await response.json();
        console.error('Error details:',errorData);
      }
     
    
      
        
      } catch (error) {
        console.log('error',error)
      }
      }
      // const RcaText=document.getElementById("rcatext").value;
  
      // RcaText.innerText=${RcaData.RCA}
      // get rca info 
  async function RcaGetData(){
    try {
      const id=localStorage.getItem("rcasummaryid");
      // console.log(id);
      if(!id){
        console.log("no rcasummary");
        return;
      }
      const response=document.getElementById(`http://localhost:3000/rca/rcagetdata/${id}`);
      const data=await response.json();
      console.log('getdatain the popup',data);
       const GetRcaData=JSON.parse(localStorage.getItem("rcainformation"));
       document.getElementById("rcatext").value=GetRcaData;
       
    } catch (error) {
      console.log("not updating rca value")
    }
  }

